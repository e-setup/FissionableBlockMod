<pe:mcml>
<script type="text/npl" src="SetPropertyTask.lua" refresh="false">
<![CDATA[
    NPL.load("(gl)Mod/fissionable_block/ItemFissionable.lua");
    FissionContext = commonlib.gettable("Mod.FissionableBlock.FissionContext");
    local color = {r=255,b=255,g=255}
    local textureid = nil;
    local type = 0;
    local should_update = false;

    function hidepage(name)
        --_guihelper.MessageBox(string.format("current choise:%d\n",Page("#tex_type"):GetValue()));
        if(should_update) then
            FissionContext:SetProperty({type=type,color=color,textureid=textureid});
        end
        FissionContext:ClosePropertyPage();
        Page:Close();
    end

    function ColorChanged(r,g,b)
        if(r and g and b) then
            should_update = true;
            color = {r=r,g=g,b=b}
            FissionContext:SetProperty({type=type,color=color,textureid=textureid});
        end
    end

    function TextureChanged(name)
        textureid = Page("#"..name):GetValue();
        --_guihelper.MessageBox(textureid);
    end

    function OnTypeChange(name)
        should_update = true;
        type = Page:GetUIValue("tex_type");
    end

    Page:SetNodeValue("blockcolor",FissionContext:GetCurrentColor());
]]>
</script>
<aries:window mode="thin" style='width:250px;height:250px;color:#ffffff;' title='<%=L"可分裂方块属性" %>'>
    <div style="margin:10px;width:230px">
        <div><input type="radio" checked="checked" onclick="OnTypeChange()" style="margin:2px" name="tex_type" id="color" value="0"/><div style="float:left;" for="color"><%=L"颜色"%></div></div>
        <pe:colorpicker name="blockcolor" version="1" style="width:180px;" onchange="ColorChanged()"/>
    </div>
    <hr />
    <div style="margin:10px;width:230px">
        <div><input type="radio" style="margin:2px" onclick="OnTypeChange()" name="tex_type" id="material" value="1"/><div style="float:left;" for="material"><%=L"材质"%></div></div>
        <select name="texture" onselect="TextureChanged()" AllowUserEdit="false" class="mc_text" DataSource='<%=FissionContext.GetTextureList()%>' style="width:200px;height:30px;"/>
    </div>
    <div style="margin:10px;width:230px">
        <input type="button" name="okButton" style="margin-left:60px;width:100px;height:30px;color:#ffffff;" value="确定" class="mc_small_button" onclick="hidepage()"/>
    </div>
</aries:window>
</pe:mcml>
